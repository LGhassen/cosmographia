/*
 * $Revision: 223 $ $Date: 2010-03-30 05:44:44 -0700 (Tue, 30 Mar 2010) $
 *
 * Copyright by Astos Solutions GmbH, Germany
 *
 * this file is published under the Astos Solutions Free Public License
 * For details on copyright and terms of use see
 * http://www.astos.de/Astos_Solutions_Free_Public_License.html
 */

#include "ConstellationsLayer.h"
#include "RenderContext.h"
#include "GeometryBuffer.h"

using namespace vesta;
using namespace Eigen;


// Standard constellation diagrams. Each record contains two Tycho star
// ids that give the endpoints of diagram segment.
static ConstellationsLayer::ConstellationSegment ConstellationSegments[] =
{
    { 1031801735, 1005292279 },
    { 1005292279, 1016672798 },
    { 1016672798, 1022713282 },
    { 1031801735, 1017532275 },
    { 1017532275, 1013292286 },
    { 1013292286, 2023112837 },
    { 1030387166, 1023156610 },
    { 1023156610, 1020657184 },
    { 1020657184, 1022957211 },
    { 1023939436, 1035169446 },
    { 1035169446, 1022829450 },
    { 1022829450, 1031549447 },
    { 1019975760, 1017255216 },
    { 1017255216, 1018065224 },
    { 1018065224, 1016065226 },
    { 1016065226, 2016055226 },
    { 2016055226, 1022985233 },
    { 1022985233, 1014005249 },
    { 1014005249, 1014065813 },
    { 1014065813, 1012475819 },
    { 1012475819, 1013826387 },
    { 1013826387, 1013556401 },
    { 1018180560, 2016055226 },
    { 1018065224, 1019965803 },
    { 1019965803, 1018665806 },
    { 1018665806, 1016835808 },
    { 1025311585, 1030271052 },
    { 1030271052, 1025771061 },
    { 1025771061, 1033991058 },
    { 1033991058, 1033550493 },
    { 1033550493, 1026825161 },
    { 1026825161, 1030270480 },
    { 1030270480, 1062270469 },
    { 1062270469, 1030271052 },
    { 1062270469, 1023575136 },
    { 1023575136, 1047815140 },
    { 1016988365, 1026008350 },
    { 1026008350, 1028668732 },
    { 1028668732, 1038578736 },
    { 1038578736, 1014398730 },
    { 1014398730, 1022088726 },
    { 1022088726, 1026008350 },
    { 1038578736, 1041189053 },
    { 1014398730, 1030678725 },
    { 1018351209, 1019351212 },
    { 1019351212, 1024161758 },
    { 1024161758, 1014901789 },
    { 1014701859, 1015732418 },
    { 1015732418, 1027422924 },
    { 1027422924, 1031413358 },
    { 1031413358, 1012752907 },
    { 1012752907, 1022372899 },
    { 1022372899, 1022362899 },
    { 1022362899, 1014462391 },
    { 1014462391, 1014701859 },
    { 1011801460, 1001321460 },
    { 1001321460, 1011571470 },
    { 1011571470, 2014361472 },
    { 2014361472, 1013371477 },
    { 1013371477, 2014710917 },
    { 2014361472, 1011402553 },
    { 1011402553, 1011513036 },
    { 1011513036, 1012583047 },
    { 1012583047, 1016392566 },
    { 1016392566, 1012512019 },
    { 1012512019, 2014361472 },
    { 1016937589, 1001307045 },
    { 1012503715, 1018944071 },
    { 1018944071, 1021064335 },
    { 1021064335, 1024784079 },
    { 1024784079, 1023203734 },
    { 1030290814, 1027581396 },
    { 1027581396, 1016220794 },
    { 1027581396, 1029051399 },
    { 1029051399, 1020111949 },
    { 1026453021, 1025413020 },
    { 1029185938, 1027775949 },
    { 1027775949, 1026185967 },
    { 1026185967, 1019385963 },
    { 1019385963, 1022345388 },
    { 1027775949, 1037226523 },
    { 1037226523, 1050016532 },
    { 1050016532, 1037936531 },
    { 1037936531, 1036196535 },
    { 1050016532, 1050036532 },
    { 1050036532, 1045256550 },
    { 1050036532, 1042046541 },
    { 1021840187, 1027740764 },
    { 1025305749, 1022815753 },
    { 1022815753, 1014996350 },
    { 1014996350, 1012206360 },
    { 1012206360, 1010786362 },
    { 1010786362, 1010446363 },
    { 1010446363, 1011766370 },
    { 1011766370, 1012786372 },
    { 1012786372, 1003356928 },
    { 1003356928, 1009876930 },
    { 1009876930, 1015766925 },
    { 1015766925, 1022815753 },
    { 2022728950, 1026039200 },
    { 1026039200, 1028429214 },
    { 1028429214, 1017658965 },
    { 1017658965, 1043248956 },
    { 1043248956, 1034478943 },
    { 1034478943, 1033128595 },
    { 1033128595, 2026928579 },
    { 2026928579, 1028838553 },
    { 1028838553, 1022778534 },
    { 1019853664, 1026683663 },
    { 1026683663, 1023194017 },
    { 1023194017, 1032894031 },
    { 1032894031, 1028344036 },
    { 1053838976, 1029238973 },
    { 1029238973, 1020028621 },
    { 1020028621, 1034788242 },
    { 1034788242, 1032358241 },
    { 1032358241, 1014138239 },
    { 1014138239, 2027248240 },
    { 2027248240, 1029298663 },
    { 1029298663, 2039199005 },
    { 1058499007, 1029298663 },
    { 1029298663, 1035458267 },
    { 1035458267, 1027437797 },
    { 1027437797, 1027447797 },
    { 1027447797, 1022157293 },
    { 1020747275, 1023937792 },
    { 1023937792, 1027447797 },
    { 1027447797, 1037067814 },
    { 1037067814, 1035207828 },
    { 1014793995, 1024313990 },
    { 1024313990, 1015903981 },
    { 1015903981, 1018704252 },
    { 1018704252, 1019674246 },
    { 1019674246, 1021684237 },
    { 1015903981, 1011024277 },
    { 1011024277, 1035844606 },
    { 1035844606, 1026434465 },
    { 1026434465, 1018704252 },
    { 2017210050, 1016180058 },
    { 1016180058, 1009850641 },
    { 1009850641, 1009370643 },
    { 1009370643, 1014910632 },
    { 1014910632, 1016810052 },
    { 1016810052, 2017210050 },
    { 2017210050, 1016330046 },
    { 1016330046, 1011444693 },
    { 1011444693, 1024375278 },
    { 1024375278, 1019845274 },
    { 1019845274, 1026575273 },
    { 1026575273, 1010845261 },
    { 1010845261, 1023335847 },
    { 1023335847, 1022925855 },
    { 1022925855, 1024375278 },
    { 1027149398, 1017149401 },
    { 1017149401, 1015439420 },
    { 1015439420, 1026539418 },
    { 1026539418, 1027159398 },
    { 1027159398, 1027149398 },
    { 1010618706, 1014459015 },
    { 1014459015, 2019908707 },
    { 1020607077, 1021237080 },
    { 1021237080, 1020247066 },
    { 1020247066, 1014827069 },
    { 1014827069, 1013577064 },
    { 1013577064, 1011797063 },
    { 1014827069, 1009897606 },
    { 1011341454, 1024001996 },
    { 1024001996, 1018951991 },
    { 1022967421, 1017377422 },
    { 1017377422, 1026537917 },
    { 1026537917, 1015247918 },
    { 1015247918, 1028567921 },
    { 1028567921, 1027957925 },
    { 1016292564, 1016052032 },
    { 1016052032, 1016902029 },
    { 1016902029, 1016742036 },
    { 1016742036, 1018272037 },
    { 1018272037, 1018262037 },
    { 1018262037, 1018052041 },
    { 1009956672, 1009926668 },
    { 1009926668, 1017546098 },
    { 1017546098, 1023956103 },
    { 1023956103, 1011166683 },
    { 1011166683, 1009926668 },
    { 1015326094, 1020326096 },
    { 1020326096, 1021556088 },
    { 1021556088, 1014235514 },
    { 1014235514, 1013895512 },
    { 1013895512, 1015085510 },
    { 1021556088, 1012746649 },
    { 1012746649, 1019016079 },
    { 1019016079, 1014235514 },
    { 1034228654, 1034658979 },
    { 1022638645, 1031078659 },
    { 1033473574, 1022233156 },
    { 1022233156, 1018162677 },
    { 1018162677, 1052482656 },
    { 1052482656, 1029632133 },
    { 1019713920, 1021123555 },
    { 1021123555, 2024863557 },
    { 2024863557, 1022233156 },
    { 1022233156, 1041392695 },
    { 1041392695, 1027642702 },
    { 1016841096, 1017201100 },
    { 1017201100, 1024421633 },
    { 1024421633, 1030561634 },
    { 1030561634, 1030551634 },
    { 1030551634, 1017201100 },
    { 1017103910, 1016843523 },
    { 1016843523, 1018003521 },
    { 1018003521, 1016203892 },
    { 1016203892, 1017103910 },
    { 1017103910, 1022394444 },
    { 1022394444, 1026524449 },
    { 1026524449, 1021074456 },
    { 1021074456, 1014914437 },
    { 1014914437, 1014254436 },
    { 1014254436, 1010484210 },
    { 1010484210, 1025684190 },
    { 1025684190, 1015433883 },
    { 1015433883, 1016203875 },
    { 1016203875, 1012624174 },
    { 1012624174, 1018704394 },
    { 1018704394, 1018054392 },
    { 1019320541, 1025831109 },
    { 1025831109, 2025831108 },
    { 2025831108, 1023540536 },
    { 1017235330, 1016714759 },
    { 1016714759, 1018414745 },
    { 1018414745, 1019164740 },
    { 1019164740, 1014844738 },
    { 1014844738, 1019704732 },
    { 1019704732, 1012855311 },
    { 1012855311, 1013205303 },
    { 1013205303, 1015335296 },
    { 1015335296, 1012595295 },
    { 1012595295, 1010765287 },
    { 1010765287, 1010505866 },
    { 1010505866, 1011106438 },
    { 1011106438, 1012925878 },
    { 1012925878, 1012665880 },
    { 1012665880, 1013706448 },
    { 1013706448, 1013726448 },
    { 1013726448, 1012686455 },
    { 1012686455, 1012426470 },
    { 1012426470, 1015097038 },
    { 1015097038, 1015347040 },
    { 1015347040, 1013747035 },
    { 1013747035, 1015867570 },
    { 1015867570, 1017487572 },
    { 1017487572, 1011837567 },
    { 1011837567, 1010177563 },
    { 1010177563, 1011607559 },
    { 1011607559, 1009877558 },
    { 1009877558, 1013808052 },
    { 1013808052, 1012708055 },
    { 1012708055, 1013218047 },
    { 1013218047, 1013958478 },
    { 2009906445, 1010197012 },
    { 1010197012, 1023296432 },
    { 1014291878, 1016391897 },
    { 1016391897, 1010592438 },
    { 1010592438, 2024072457 },
    { 2024072457, 1021941920 },
    { 1021941920, 1026721359 },
    { 1026721359, 1015501353 },
    { 1015501353, 1017461329 },
    { 1023560754, 1017461329 },
    { 1017461329, 1018121336 },
    { 1018121336, 1014291878 },
    { 1014291878, 2017161877 },
    { 1017487494, 1013437995 },
    { 1013437995, 1015697999 },
    { 1015697999, 1013728003 },
    { 1013728003, 1016448446 },
    { 1016448446, 1014998453 },
    { 1014998453, 1015038824 },
    { 2012488012, 1013628448 },
    { 1013628448, 1016448446 },
    { 1016448446, 1019598438 },
    { 1018763510, 1022982620 },
    { 1022982620, 1017762604 },
    { 1017762604, 1017742604 },
    { 1017742604, 1015953070 },
    { 1015953070, 1022133066 },
    { 1022133066, 1019093492 },
    { 1019093492, 1018423067 },
    { 1030782103, 1027722102 },
    { 1027722102, 1030622085 },
    { 1030622085, 1020572079 },
    { 1020572079, 1019302065 },
    { 1019302065, 1014122590 },
    { 1014122590, 2031582582 },
    { 2031582582, 1014421518 },
    { 1014421518, 1021340990 },
    { 1014421518, 1012611513 },
    { 1017742604, 1014122590 },
    { 1015953070, 2031582582 },
    { 1011160225, 1020210215 },
    { 1020210215, 1020220215 },
    { 1020220215, 1017950223 },
    { 1017950223, 2013330224 },
    { 2013330224, 1011160225 },
    { 1011160225, 1025440227 },
    { 1025440227, 1025294894 },
    { 1025294894, 1015925460 },
    { 1015925460, 1016535487 },
    { 1016535487, 1013105485 },
    { 1013105485, 1011346061 },
    { 1011346061, 1018316075 },
    { 1018316075, 1012617216 },
    { 1012617216, 1016507226 },
    { 1016507226, 1013696699 },
    { 1013696699, 1014366700 },
    { 1014366700, 1013816738 },
    { 1020278851, 1016269350 },
    { 1016269350, 1016349159 },
    { 1016349159, 1020278851 },
    { 1018228411, 1014798793 },
    { 1012578812, 1014798793 },
    { 1014798793, 1013758804 },
    { 1035913199, 1024023203 },
    { 1024023203, 1022603209 },
    { 1022603209, 1026003607 },
    { 1026003607, 1023043611 },
    { 1023043611, 1030213615 },
    { 1030213615, 1031933628 },
    { 1031933628, 1040813619 },
    { 1013810833, 1028471437 },
    { 1028471437, 1009880870 },
    { 1009880870, 1024791439 },
    { 1024791439, 2013491423 },
    { 2013491423, 1016951412 },
    { 1016951412, 1013810833 },
    { 2013491423, 1012611969 },
    { 1012611969, 1014731964 },
    { 1014731964, 1015501960 },
    { 1022712521, 1012092517 },
    { 1012092517, 1013432509 },
    { 1013705360, 1017785359 },
    { 1017785359, 1016855920 },
    { 1016855920, 1017215902 },
    { 1021955930, 1021975930 },
    { 1021975930, 1016575928 },
    { 1016575928, 1013745913 },
    { 1016855920, 1016575928 },
    { 1013685623, 1015446187 },
    { 1015446187, 1016626186 },
    { 1016626186, 1013815608 },
    { 1013815608, 1010145585 },
    { 1010145585, 1012106155 },
    { 1012106155, 1014556752 },
    { 1014556752, 1015906776 },
    { 1015906776, 1018006789 },
    { 1010145585, 1014556752 },
    { 1013147342, 1018147851 },
    { 1018147851, 2014327840 },
    { 2014327840, 1025057847 },
    { 1025057847, 1041848298 },
    { 1041848298, 1033628306 },
    { 1033628306, 1041348283 },
    { 1041348283, 1024907832 },
    { 1024907832, 1028047839 },
    { 1028047839, 1016917325 },
    { 1016917325, 1025127332 },
    { 1028047839, 2014327840 },
    { 1017282496, 2016552499 },
    { 2016552499, 1019782986 },
    { 1019782986, 1021842980 },
    { 1021842980, 1016483401 },
    { 1016483401, 1017303779 },
    { 1017303779, 1024653776 },
    { 1020703105, 1020803118 },
    { 1020803118, 1029292642 },
    { 1029292642, 1033462643 },
    { 1033462643, 1025482651 },
    { 1025482651, 1020803118 },
    { 1015919169, 1010019173 },
    { 1010019173, 1016929378 },
    { 1016929378, 1009879176 },
    { 1014457465, 1011297475 },
    { 1011297475, 1009237476 },
    { 1009237476, 1012007983 },
    { 1033940158, 1024510141 },
    { 1024510141, 1025800152 },
    { 1025800152, 1038154815 },
    { 1038154815, 1027465414 },
    { 1027465414, 1028784851 },
    { 1038154815, 1018824797 },
    { 1018824797, 1017694795 },
    { 1023809249, 1030499228 },
    { 1030499228, 1027059227 },
    { 1027059227, 1030458985 },
    { 2030479228, 1030499228 },
    { 1030499228, 1029079236 },
    { 1044418316, 1022908320 },
    { 1022908320, 1011288318 },
    { 1038549509, 1010539488 },
    { 1010539488, 1014839478 },
    { 1014839478, 1038549509 },
    { 1005776829, 1004626825 },
    { 1004626825, 1006646246 },
    { 1006646246, 2013336232 },
    { 2013336232, 1010425632 },
    { 1010425632, 1009995042 },
    { 1009995042, 1010685037 },
    { 1010685037, 2020620386 },
    { 2020620386, 1021980979 },
    { 1021980979, 1025081000 },
    { 1025081000, 1017240423 },
    { 1017240423, 2013336232 },
    { 1017240423, 1019620420 },
    { 1019620420, 1009565678 },
    { 1018730129, 2024000705 },
    { 2024000705, 1018560113 },
    { 1018560113, 2024454766 },
    { 2024454766, 2015884757 },
    { 2015884757, 1017525331 },
    { 1017525331, 1007605351 },
    { 1007605351, 2011884771 },
    { 2011884771, 1018730129 },
    { 1018730129, 1024680721 },
    { 1024680721, 1024720742 },
    { 1024720742, 1015161321 },
    { 1015161321, 1021181320 },
    { 1019800729, 1024720742 },
    { 2011884771, 1024504766 },
    { 1024504766, 2024454766 },
    { 1018560113, 1014620096 },
    { 1018670688, 1012170683 },
    { 1012170683, 1014620096 },
    { 1014620096, 1023450092 },
    { 1023450092, 1025580089 },
    { 1025580089, 1023620085 },
    { 1018988785, 1016059112 },
    { 1016059112, 1018939315 },
    { 1018939315, 1023619299 },
    { 1023619299, 1036159062 },
    { 1036159062, 1036559059 },
    { 1036559059, 1028239068 },
    { 1028239068, 1022039074 },
    { 1022039074, 1019189098 },
    { 1019189098, 1016059112 },
    { 1016059112, 1014239111 },
    { 1031801735, 1017751179 },
    { 1017751179, 1024751711 },
    { 1024751711, 1018312243 },
    { 1018312243, 1031801735 },
    { 1020172193, 1024712208 },
    { 1024712208, 1018232736 },
    { 1018232736, 1018312243 },
    { 1018312243, 1018212225 },
    { 1018212225, 1016662221 },
    { 1016662221, 1009181670 },
    { 1009181670, 1009861671 },
    { 1024751711, 1021861155 },
    { 1021861155, 1021871155 },
    { 1021871155, 1019990565 },
    { 1019990565, 1021861125 },
    { 1021183291, 1013323704 },
    { 1013323704, 1013933701 },
    { 1013933701, 1028083320 },
    { 1014292846, 1015722847 },
    { 1015722847, 1021682851 },
    { 1021682851, 1022742859 },
    { 1022742859, 1028083320 },
    { 1028083320, 1030343317 },
    { 1030343317, 1016232868 },
    { 1016232868, 1022732369 },
    { 1022732369, 1028202361 },
    { 1028202361, 2012582359 },
    { 1011798043, 1011347547 },
    { 1011347547, 1010718032 },
    { 1010718032, 1010317527 },
    { 1010317527, 1012408022 },
    { 1012408022, 1009698020 },
    { 1009698020, 1013458456 },
    { 1013458456, 1012128463 },
    { 1010718032, 1013048476 },
    { 1013048476, 1015968469 },
    { 1015968469, 1012408022 },
    { 1013928099, 1012808524 },
    { 1012808524, 1022028899 },
    { 1017440591, 1014580586 },
    { 1014580586, 1014150578 },
    { 1014150578, 1018840580 },
    { 1018840580, 1015150584 },
    { 1015150584, 1017440591 },
    { 1017440591, 1016970593 },
    { 1016970593, 1013010604 },
    { 1013010604, 1014460612 },
    { 1014460612, 1004350035 },
    { 1004350035, 2013380040 },
    { 2013380040, 1005740622 },
    { 1005740622, 1015971198 },
    { 1015971198, 1022631747 },
    { 1022631747, 1021781751 },
    { 1021781751, 1012602278 },
    { 1012676977, 1013127508 },
    { 1013127508, 1013157508 },
    { 1013157508, 1015117497 },
    { 1015117497, 1014667492 },
    { 1014667492, 1018397490 },
    { 1018397490, 1019847487 },
    { 1019847487, 2018666960 },
    { 2018666960, 1016266961 },
    { 1016266961, 1015096966 },
    { 1015096966, 1012676977 },
    { 1032456555, 1040937663 },
    { 1040937663, 1026877655 },
    { 1026877655, 1014617642 },
    { 1014617642, 1023148125 },
    { 1023148125, 1022037626 },
    { 1022037626, 1030197115 },
    { 1030197115, 1045226557 },
    { 1045226557, 1032456555 },
    { 1036397144, 1027257141 },
    { 1027257141, 1027816580 },
    { 1024618869, 1013858870 },
    { 1013858870, 1013188868 },
    { 1013188868, 1020418508 },
    { 1020418508, 1024618869 },
    { 1023411606, 1035421619 },
    { 1035421619, 1023421606 },
    { 1035421619, 1034141624 },
    { 1070577404, 1034717401 },
    { 1034717401, 1021706856 },
    { 1021706856, 1031806861 },
    { 1031806861, 1024286867 },
    { 1024286867, 1028376885 },
    { 1028376885, 1017776881 },
    { 1017776881, 1018296868 },
    { 1018296868, 1024286867 },
    { 1031806861, 1030946276 },
    { 1018296868, 1024926295 },
    { 1024926295, 1002826295 },
    { 1002826295, 1024576301 },
    { 1024926295, 1025076294 },
    { 1017776881, 1021326893 },
    { 1021326893, 1022366900 },
    { 1022366900, 1013577448 },
    { 1013577448, 1032417942 },
    { 1032417942, 1021067943 },
    { 1032417942, 1021397935 },
    { 2015376209, 1016236208 },
    { 1016236208, 1021946779 },
    { 1021946779, 1026976783 },
    { 1026976783, 1025096791 },
    { 1021946779, 1005406798 },
    { 1005406798, 1021586803 },
    { 1021586803, 1010126807 },
    { 1010126807, 1008047367 },
    { 1008047367, 1018217868 },
    { 1018217868, 1028717876 },
    { 1028717876, 1005697882 },
    { 1005697882, 2076797892 },
    { 2076797892, 1026697889 },
    { 1026697889, 1020657885 },
    { 1020657885, 1010937388 },
    { 1010937388, 1012497387 },
    { 1013578013, 1010897510 },
    { 1010897510, 1013376988 },
    { 1013376988, 1022706424 },
    { 1014265122, 1013385691 },
    { 1028825702, 1013385691 },
    { 1013385691, 1012635690 },
    { 1006870457, 1004165102 },
    { 1004165102, 1014865668 },
    { 1014865668, 1013696248 },
    { 1013696248, 1014315653 },
    { 1009365022, 1012260360 },
    { 1012260360, 1011350363 },
    { 1011350363, 1012390933 },
    { 1012390933, 1019941495 },
    { 1019941495, 1021191496 },
    { 1021191496, 1017891498 },
    { 1017891498, 1019941495 },
    { 1013814912, 1017504903 },
    { 1017504903, 1013795475 },
    { 1014701859, 1011041273 },
    { 1011041273, 1012671268 },
    { 1012671268, 1010091264 },
    { 1010091264, 1011721265 },
    { 1011721265, 1014161266 },
    { 1014161266, 1026971310 },
    { 1010091264, 1015460662 },
    { 1015460662, 1014690650 },
    { 1014690650, 1014710650 },
    { 1027558367, 1036508359 },
    { 1036508359, 1038628357 },
    { 1030281763, 1016472317 },
    { 1016472317, 1018752318 },
    { 1018752318, 1030281763 },
    { 1036419275, 1057129027 },
    { 1057129027, 1049059259 },
    { 1049059259, 1036419275 },
    { 1019199120, 1019479117 },
    { 1019479117, 1012978837 },
    { 1012978837, 1015198844 },
    { 1015198844, 1017068843 },
    { 1017068843, 1016529133 },
    { 1016529133, 1012978837 },
    { 1012573467, 1013863850 },
    { 1013863850, 1011903845 },
    { 1011903845, 1010703837 },
    { 1010703837, 1010343833 },
    { 1010343833, 1010793827 },
    { 1010793827, 2012744146 },
    { 2012744146, 1010703837 },
    { 2012744146, 1013044139 },
    { 1013044139, 1024314127 },
    { 1024314127, 1015223820 },
    { 1015223820, 1010793827 },
    { 1015223820, 1014513432 },
    { 1014513432, 1021493420 },
    { 1021493420, 1016263424 },
    { 1010343833, 1021403452 },
    { 1021403452, 1026312520 },
    { 1021403452, 1025193012 },
    { 1025193012, 1014183004 },
    { 1014183004, 1012863007 },
    { 1002374628, 1010534655 },
    { 1010534655, 1011544580 },
    { 1011544580, 1027084563 },
    { 1027084563, 1017644567 },
    { 1017644567, 1023144414 },
    { 1023144414, 1017994416 },
    { 1017994416, 1027084563 },
    { 2030338206, 1020248602 },
    { 1020248602, 1042008588 },
    { 1042008588, 2035718573 },
    { 2035718573, 1065338140 },
    { 1065338140, 1008667670 },
    { 1008667670, 1022337683 },
    { 1022337683, 1026177689 },
    { 1026177689, 1026207696 },
    { 1026207696, 1037047716 },
    { 1037047716, 1033378201 },
    { 1033378201, 2030338206 },
    { 1009424997, 1016454982 },
    { 1016454982, 1017385558 },
    { 1017385558, 1015185547 },
    { 1015185547, 1013164963 },
    { 1013164963, 2011204949 },
    { 2011204949, 1010320294 },
    { 1010320294, 1013664966 },
    { 1013664966, 1012710316 },
    { 1012710316, 1014260326 },
    { 1013260886, 1010320294 },
    { 2011204949, 1011584940 },
    { 1011584940, 1009240273 },
    { 1027298939, 1028208937 },
    { 1028208937, 2030909193 },
    { 2030909193, 1018649188 },
    { 1018649188, 1014119182 },
    { 1014119182, 1021079179 },
    { 1021079179, 2030909193 },
    { 2025572124, 1027722129 },
    { 1027722129, 2030512140 },
};


ConstellationsLayer::ConstellationsLayer(StarCatalog* starCatalog) :
    m_starCatalog(starCatalog),
    m_diagramColor(1.0f, 1.0f, 1.0f)
{
}


ConstellationsLayer::~ConstellationsLayer()
{
}


void
ConstellationsLayer::render(RenderContext& rc)
{
    Material material;
    material.setDiffuse(m_diagramColor);
    rc.bindMaterial(&material);
    glDepthMask(GL_FALSE);
    glLineWidth(1.0f);

    GeometryBuffer geo(&rc);

    geo.beginLines();

    for (unsigned int i = 0; i < m_segments.size() / 2; ++i)
    {
        Vector3f v0 = m_segments[i * 2];
        Vector3f v1 = m_segments[i * 2 + 1];
        Vector3f dv = v1 - v0;
        float segmentLength = dv.norm();

        // Draw each constellation diagram segment with a slight gap
        // at each end so that stars aren't obscured.
        const float gapPixels = 5.0f;
        float gapLength = rc.pixelSize() * gapPixels;
        if (segmentLength > gapLength * 2.0f)
        {
            float gap = gapLength / segmentLength;
            v0 += dv * gap;
            v1 -= dv * gap;
            geo.vertex(v0);
            geo.vertex(v1);
        }
    }

    geo.end();
}


// Compute the position of a star on the unit sphere.
static Vector3f StarPositionCartesian(const StarCatalog::StarRecord& star)
{
    float cosDec = cos(star.declination);
    return Vector3f(cosDec * cos(star.RA), cosDec * sin(star.RA), sin(star.declination));
}


/** Enable the built-in set of constellation diagrams.
  */
void
ConstellationsLayer::setDefaultConstellations()
{
    m_segments.clear();

    if (m_starCatalog.isNull())
    {
        return;
    }

    unsigned int segmentCount = sizeof(ConstellationSegments) / sizeof(ConstellationSegments[0]);
    for (unsigned int i = 0; i < segmentCount; ++i)
    {
        const StarCatalog::StarRecord* star0 = m_starCatalog->findStarIdentifier(ConstellationSegments[i].starId0);
        const StarCatalog::StarRecord* star1 = m_starCatalog->findStarIdentifier(ConstellationSegments[i].starId1);
        if (star0 && star1)
        {
            m_segments.push_back(StarPositionCartesian(*star0));
            m_segments.push_back(StarPositionCartesian(*star1));
        }
    }
}
